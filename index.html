<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simplism簡單保養 - 新人限定轉盤抽獎</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@19/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@19/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
body { font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif; }
@keyframes float { 0%,100%{transform:translateY(0) rotate(0deg);}50%{transform:translateY(-20px) rotate(180deg);} }
.animate-float { animation: float 6s ease-in-out infinite; }
@keyframes rotate-lights { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
.animate-rotate-lights { animation: rotate-lights 3s linear infinite; }
@keyframes slideUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }
.animate-slide-up { animation: slideUp 0.6s ease; }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
// -------- PRIZES --------
const PRIZES = [
  { name: '現折<br>30元', code: 'NEW30T', probability: 15, sectionIndex: 0, gradient: 'linear-gradient(135deg, #D3E5F2 0%, #A4C9E8 100%)' },
  { name: '現折<br>50元', code: 'NEW50F', probability: 25, sectionIndex: 1, gradient: 'linear-gradient(135deg, #B9D7EA 0%, #769FCD 100%)' },
  { name: '現折<br>80元', code: 'NEW80E', probability: 30, sectionIndex: 2, gradient: 'linear-gradient(135deg, #A4C9E8 0%, #6892C3 100%)' },
  { name: '現折<br>100元', code: 'NEW100H', probability: 20, sectionIndex: 3, gradient: 'linear-gradient(135deg, #B9D7EA 0%, #769FCD 100%)' },
  { name: '角質調理露<br>20ml', code: 'NEW20AC', probability: 10, sectionIndex: 4, gradient: 'linear-gradient(135deg, #D3E5F2 0%, #A4C9E8 100%)' }
];

// -------- COMPONENTS --------
const FloatingShape = ({ className, delay }) => (
  <div className={`absolute rounded-full opacity-10 animate-float ${className}`} style={{ animationDelay: delay }} />
);

const WheelSection = ({ prize, index }) => {
  const rotation = index * 72;
  return (
    <div
      className="absolute w-1/2 h-1/2 origin-bottom-right flex items-center justify-center font-bold text-xs sm:text-sm text-white text-shadow p-4 box-border border-r-2 border-b-2 border-white/40"
      style={{ transform: `rotate(${rotation}deg)`, background: prize.gradient }}
    >
      <div dangerouslySetInnerHTML={{ __html: prize.name }} className="transform -rotate-45 text-center leading-tight" />
    </div>
  );
};

// -------- APP --------
const App = () => {
  const [rotation, setRotation] = React.useState(0);
  const [isSpinning, setIsSpinning] = React.useState(false);
  const [spunPrize, setSpunPrize] = React.useState(null);
  const [showCopySuccess, setShowCopySuccess] = React.useState(false);

  React.useEffect(() => {
    const savedResult = localStorage.getItem('simplism_lottery_result');
    if (savedResult) setSpunPrize(JSON.parse(savedResult));
  }, []);

  const getRandomPrize = React.useCallback(() => {
    const random = Math.random() * 100;
    let cumulativeProbability = 0;
    for (const prize of PRIZES) {
      cumulativeProbability += prize.probability;
      if (random <= cumulativeProbability) return prize;
    }
    return PRIZES[0];
  }, []);

  const spinWheel = React.useCallback(() => {
    if (spunPrize || isSpinning) return;
    setIsSpinning(true);
    const selectedPrize = getRandomPrize();
    const sectionAngle = 72;
    const baseVisualAngle = 225;
    const targetPrizeAngle = baseVisualAngle + selectedPrize.sectionIndex * sectionAngle;
    const pointerPositionAngle = 270;
    const rotationToTarget = (pointerPositionAngle - targetPrizeAngle + 360) % 360;
    const baseRotation = 2160;
    const jitter = Math.random() * 10 - 5;
    setRotation(baseRotation + rotationToTarget + jitter);
    setTimeout(() => {
      setSpunPrize(selectedPrize);
      setIsSpinning(false);
      localStorage.setItem('simplism_lottery_result', JSON.stringify(selectedPrize));
    }, 4000);
  }, [spunPrize, isSpinning, getRandomPrize]);

  const copyCode = React.useCallback(() => {
    if (!spunPrize) return;
    navigator.clipboard.writeText(spunPrize.code).then(() => {
      setShowCopySuccess(true);
      setTimeout(() => setShowCopySuccess(false), 2000);
    });
  }, [spunPrize]);

  const hasSpun = !!spunPrize;

  return (
    <div className="bg-gradient-to-br from-slate-50 to-blue-100 min-h-screen w-full flex items-center justify-center p-4 relative overflow-hidden">
      <div className="fixed top-0 left-0 w-full h-full pointer-events-none z-0">
        <FloatingShape className="w-20 h-20 bg-gradient-to-r from-blue-300 to-blue-400 top-[10%] left-[10%]" delay="0s" />
        <FloatingShape className="w-16 h-16 bg-gradient-to-r from-sky-300 to-cyan-300 top-[20%] right-[15%]" delay="2s" />
        <FloatingShape className="w-24 h-24 bg-gradient-to-r from-blue-400 to-indigo-400 bottom-[15%] left-[20%]" delay="4s" />
      </div>

      <div className="max-w-xl w-full bg-white/95 rounded-3xl shadow-2xl shadow-blue-200 p-6 sm:p-10 text-center relative z-10 backdrop-blur-sm border-2 border-blue-200/30">
        <h1 className="text-3xl sm:text-4xl font-extrabold bg-gradient-to-r from-slate-600 to-slate-800 bg-clip-text text-transparent mb-2 tracking-wide">
          Simplism簡單保養
        </h1>
        <p className="inline-block text-lg md:text-xl text-slate-600 mt-4 mb-12 font-semibold bg-[#ECF5FC] px-8 py-2 rounded-full shadow-md">
          新客限定｜轉出你的專屬優惠
        </p>

        <div className="relative w-72 h-72 sm:w-80 sm:h-80 mx-auto mb-10">
          <div className="absolute inset-0 animate-rotate-lights rounded-full" style={{
            background: 'conic-gradient(#A9CCE3 0deg 30deg, transparent 30deg 60deg, #EAF2F8 60deg 90deg, transparent 90deg 120deg, #A9CCE3 120deg 150deg, transparent 150deg 180deg, #EAF2F8 180deg 210deg, transparent 210deg 240deg, #A9CCE3 240deg 270deg, transparent 270deg 300deg, #EAF2F8 300deg 330deg, transparent 330deg 360deg)',
            opacity: 0.6
          }}></div>

          <div className="absolute top-2 left-2 w-[calc(100%-16px)] h-[calc(100%-16px)] rounded-full bg-gradient-to-b from-slate-300 to-slate-400 p-1.5 shadow-lg shadow-slate-500/30">
            <div
              className="w-full h-full rounded-full relative overflow-hidden bg-white shadow-inner transition-transform duration-[4000ms] ease-[cubic-bezier(0.23,1,0.32,1)]"
              style={{ transform: `rotate(${rotation}deg)` }}
            >
              {PRIZES.map((prize, index) => <WheelSection key={prize.code} prize={prize} index={index} />)}
            </div>

            <button
              onClick={spinWheel}
              disabled={hasSpun || isSpinning}
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24 bg-gradient-to-br from-slate-500 to-slate-700 rounded-full flex items-center justify-center text-sm font-extrabold text-white shadow-lg border-4 border-slate-300 z-10 cursor-pointer transition-all duration-300 hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:scale-100"
            >
              <span>{isSpinning ? '抽獎中...' : hasSpun ? '您已抽過獎' : '立即抽獎'}</span>
            </button>
          </div>
        </div>

        {!hasSpun && (
          <button
            onClick={spinWheel}
            disabled={isSpinning}
            className="w-full max-w-xs bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold text-xl py-4 px-8 rounded-full shadow-lg shadow-slate-500/40 transition-all duration-300 hover:-translate-y-1 disabled:bg-gray-400 disabled:shadow-none disabled:translate-y-0 disabled:cursor-not-allowed"
          >
            {isSpinning ? '抽獎中...' : '馬上領取新客專屬好康！'}
          </button>
        )}

        {spunPrize && (
          <div className="mt-6 p-6 bg-[#6380A6] rounded-2xl text-white shadow-lg shadow-blue-500/40 border-2 border-white/50 animate-slide-up">
            <h2 className="text-xl font-bold mb-3">恭喜獲得 {spunPrize.name.replace('<br>', '')}！</h2>
            <div className="relative">
              <div onClick={copyCode} className="text-2xl font-black bg-white/25 py-3 px-6 rounded-lg my-3 tracking-widest cursor-pointer transition-all duration-300 hover:bg-white/40 hover:scale-105 border-2 border-white/50">{spunPrize.code}</div>
              {showCopySuccess && <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-green-500 text-white text-xs font-semibold px-3 py-1 rounded-md">已複製！</div>}
            </div>
            <p className="text-xs opacity-90">點擊文字框即可複製活動字串 ( 截圖保存以免忘記！ )</p>
            <p className="text-sm mt-1 mb-4">請至結帳頁面『活動字串』貼上使用</p>
            <a href="https://www.simplism.com.tw/products/product/" target="_blank" rel="noopener noreferrer" className="inline-block bg-gradient-to-r from-sky-400 to-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-md transition-transform hover:scale-105 hover:-translate-y-0.5">立即前往購物</a>
          </div>
        )}

      </div>
    </div>
  );
};

// -------- RENDER --------
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
